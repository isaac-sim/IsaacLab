

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>isaaclab.sim.simulation_context &#8212; Isaac Lab Documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/twemoji.css" />
    <link rel="stylesheet" type="text/css" href="/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/sphinxcontrib/icon/node_modules/@fortawesome/fontawesome-free/css/all.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.4cbf315f70debaebd550c87a6162cf0f.min.css" />
  
  <!-- So that users can add custom icons -->
  <script src="../../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="https://unpkg.com/twemoji@latest/dist/twemoji.min.js"></script>
    <script src="../../../_static/twemoji.js"></script>
    <script src="/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/sphinxcontrib/icon/node_modules/@fortawesome/fontawesome-free/js/all.min.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script src="../../../_static/design-tabs.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/isaaclab/sim/simulation_context';</script>
    <link rel="icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="2.1.1" />
    <meta name="docbuild:last-update" content="Oct 28, 2025"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/NVIDIA-logo-white.png" class="logo__image only-light" alt=""/>
    <img src="../../../_static/NVIDIA-logo-black.png" class="logo__image only-dark pst-js-only" alt=""/>
  
  
    <p class="title logo__title">Isaac Lab Documentation</p>
  
</a></div>
        <div class="sidebar-primary-item">
<nav class="bd-links bd-docs-nav">
    <div class="bd-toc-item navbar-nav">
      <ul class="nav bd-sidenav">
        <li class="toctree-l1 has-children" style="display: flex; justify-content: center; align-items: center; flex-direction: column;">
          <div  style ="text-align:center;">
            <label for="version-select" style="font-weight: bold; display: block;">Version</label>
          </div>
          <select id="version-select" class="version-dropdown" style="margin: 0 auto; display: block;" onchange="location = this.value;">
            <option value="../../../../main/index.html" >main</option>
            <option value="../../../../release/2.1.0/index.html" >release/2.1.0</option>
            <option value="../../../../release/2.2.0/index.html" >release/2.2.0</option>
            <option value="../../../../release/2.3.0/index.html" >release/2.3.0</option>
            <option value="../../../../v2.2.1/index.html" >v2.2.1</option>
            <option value="../../../../v2.2.0/index.html" >v2.2.0</option>
            <option value="simulation_context.html" selected>v2.1.1</option>
            <option value="../../../../v2.1.0/index.html" >v2.1.0</option>
            <option value="../../../../v2.0.2/index.html" >v2.0.2</option>
            <option value="../../../../v2.0.1/index.html" >v2.0.1</option>
            <option value="../../../../v2.0.0/index.html" >v2.0.0</option>
            <option value="../../../../v1.4.1/index.html" >v1.4.1</option>
            <option value="../../../../v1.4.0/index.html" >v1.4.0</option>
            <option value="../../../../v1.3.0/index.html" >v1.3.0</option>
            <option value="../../../../v1.2.0/index.html" >v1.2.0</option>
            <option value="../../../../v1.1.0/index.html" >v1.1.0</option>
            <option value="../../../../v1.0.0/index.html" >v1.0.0</option>
          </select>
        </li>
      </ul>
    </div>
</nav>
</div>
        <div class="sidebar-primary-item"><ul class="navbar-icon-links"
    aria-label="Quick Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/isaac-sim/IsaacLab" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://developer.nvidia.com/isaac-sim" title="Isaac Sim" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="https://img.shields.io/badge/IsaacSim-5.0.0-silver.svg" class="icon-link-image" alt="Isaac Sim"/></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://img.shields.io/github/stars/isaac-sim/IsaacLab?color=fedcba" title="Stars" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="https://img.shields.io/github/stars/isaac-sim/IsaacLab?color=fedcba" class="icon-link-image" alt="Stars"/></a>
        </li>
</ul></div>
        <div class="sidebar-primary-item">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Isaac Lab</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../source/setup/ecosystem.html">Isaac Lab Ecosystem</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../source/setup/installation/index.html">Local Installation</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../source/setup/installation/pip_installation.html">Pip installation (recommended for Ubuntu 22.04 and Windows)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/setup/installation/binaries_installation.html">Binary installation (recommended for Ubuntu 20.04)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/setup/installation/isaaclab_pip_installation.html">Advanced installation (Isaac Lab pip)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/setup/installation/asset_caching.html">Asset caching</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../source/deployment/index.html">Container Deployment</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../source/deployment/docker.html">Docker Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/deployment/cluster.html">Cluster Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/deployment/run_docker_example.html">Running an example with Docker</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/refs/reference_architecture/index.html">Reference Architecture</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../source/setup/quickstart.html">Quickstart Guide</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../source/setup/walkthrough/index.html">Walkthrough</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../source/setup/walkthrough/project_setup.html">Isaac Lab Project Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/setup/walkthrough/concepts_env_design.html">Environment Design Background</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/setup/walkthrough/api_env_design.html">Classes and Configs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/setup/walkthrough/technical_env_design.html">Environment Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/setup/walkthrough/training_jetbot_gt.html">Training the Jetbot: Ground Truth</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/setup/walkthrough/training_jetbot_reward_exploration.html">Exploring the RL problem</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../source/tutorials/index.html">Tutorials</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../source/tutorials/00_sim/create_empty.html">Creating an empty scene</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/tutorials/00_sim/spawn_prims.html">Spawning prims into the scene</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/tutorials/00_sim/launch_app.html">Deep-dive into AppLauncher</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/tutorials/01_assets/add_new_robot.html">Adding a New Robot to Isaac Lab</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/tutorials/01_assets/run_rigid_object.html">Interacting with a rigid object</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/tutorials/01_assets/run_articulation.html">Interacting with an articulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/tutorials/01_assets/run_deformable_object.html">Interacting with a deformable object</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/tutorials/02_scene/create_scene.html">Using the Interactive Scene</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/tutorials/03_envs/create_manager_base_env.html">Creating a Manager-Based Base Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/tutorials/03_envs/create_manager_rl_env.html">Creating a Manager-Based RL Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/tutorials/03_envs/create_direct_rl_env.html">Creating a Direct Workflow RL Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/tutorials/03_envs/register_rl_env_gym.html">Registering an Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/tutorials/03_envs/run_rl_training.html">Training with an RL Agent</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/tutorials/03_envs/modify_direct_rl_env.html">Modifying an existing Direct RL Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/tutorials/03_envs/policy_inference_in_usd.html">Policy Inference in USD Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/tutorials/04_sensors/add_sensors_on_robot.html">Adding sensors on a robot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/tutorials/05_controllers/run_diff_ik.html">Using a task-space controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/tutorials/05_controllers/run_osc.html">Using an operational space controller</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../source/how-to/index.html">How-to Guides</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../source/how-to/import_new_asset.html">Importing a New Asset</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/how-to/write_articulation_cfg.html">Writing an Asset Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/how-to/make_fixed_prim.html">Making a physics prim fixed in the simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/how-to/multi_asset_spawning.html">Spawning Multiple Assets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/how-to/save_camera_output.html">Saving rendered images and 3D re-projection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/how-to/estimate_how_many_cameras_can_run.html">Find How Many/What Cameras You Should Train With</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/how-to/configure_rendering.html">Configuring Rendering Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/how-to/draw_markers.html">Creating Visualization Markers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/how-to/wrap_rl_env.html">Wrapping environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/how-to/add_own_library.html">Adding your own learning library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/how-to/record_animation.html">Recording Animations of Simulations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/how-to/record_video.html">Recording video clips during training</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/how-to/curriculums.html">Curriculum Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/how-to/master_omniverse.html">Mastering Omniverse for Robotics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/how-to/cloudxr_teleoperation.html">Setting up CloudXR Teleoperation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/how-to/simulation_performance.html">Simulation Performance</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../source/overview/developer-guide/index.html">Developer’s Guide</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../source/overview/developer-guide/vs_code.html">Setting up Visual Studio Code</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../../source/overview/developer-guide/repo_structure.html">Repository organization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/overview/developer-guide/development.html">Extension Development</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/overview/developer-guide/template.html">Build your Own Project or Task</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../source/overview/core-concepts/index.html">Core Concepts</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../source/overview/core-concepts/task_workflows.html">Task Design Workflows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/overview/core-concepts/actuators.html">Actuators</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../source/overview/core-concepts/sensors/index.html">Sensors</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../source/overview/core-concepts/sensors/camera.html">Camera</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../source/overview/core-concepts/sensors/contact_sensor.html">Contact Sensor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../source/overview/core-concepts/sensors/frame_transformer.html">Frame Transformer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../source/overview/core-concepts/sensors/imu.html">Inertial Measurement Unit (IMU)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../source/overview/core-concepts/sensors/ray_caster.html">Ray Caster</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/overview/core-concepts/motion_generators.html">Motion Generators</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/overview/environments.html">Available Environments</a></li>

<li class="toctree-l1 has-children"><a class="reference internal" href="../../../source/overview/reinforcement-learning/index.html">Reinforcement Learning</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../source/overview/reinforcement-learning/rl_existing_scripts.html">Reinforcement Learning Scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/overview/reinforcement-learning/rl_frameworks.html">Reinforcement Learning Library Comparison</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/overview/reinforcement-learning/performance_benchmarks.html">Performance Benchmarks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/overview/reinforcement-learning/training_guide.html">Debugging and Training Guide</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/overview/teleop_imitation.html">Teleoperation and Imitation Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/overview/showroom.html">Showroom Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/overview/simple_agents.html">Simple Agents</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Features</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../source/features/hydra.html">Hydra Configuration System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/features/multi_gpu.html">Multi-GPU and Multi-Node Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/overview/core-concepts/sensors/camera.html">Tiled Rendering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/features/ray.html">Ray Job Dispatch and Tuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/features/reproducibility.html">Reproducibility and Determinism</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Resources</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../source/setup/installation/cloud_installation.html">Running Isaac Lab in the Cloud</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../source/policy_deployment/index.html">Sim2Real Deployment of Policies Trained in Isaac Lab</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../source/policy_deployment/00_hover/hover_policy.html">Training &amp; Deploying HOVER Policy</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Migration Guides</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../source/migration/migrating_from_isaacgymenvs.html">From IsaacGymEnvs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/migration/migrating_from_omniisaacgymenvs.html">From OmniIsaacGymEnvs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/migration/migrating_from_orbit.html">From Orbit</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Source API</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../source/api/index.html">API Reference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../source/api/lab/isaaclab.app.html">isaaclab.app</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/api/lab/isaaclab.actuators.html">isaaclab.actuators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/api/lab/isaaclab.assets.html">isaaclab.assets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/api/lab/isaaclab.controllers.html">isaaclab.controllers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/api/lab/isaaclab.devices.html">isaaclab.devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/api/lab/isaaclab.envs.html">isaaclab.envs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/api/lab/isaaclab.managers.html">isaaclab.managers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/api/lab/isaaclab.markers.html">isaaclab.markers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/api/lab/isaaclab.scene.html">isaaclab.scene</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/api/lab/isaaclab.sensors.html">isaaclab.sensors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/api/lab/isaaclab.sim.html">isaaclab.sim</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/api/lab/isaaclab.terrains.html">isaaclab.terrains</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/api/lab/isaaclab.utils.html">isaaclab.utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/api/lab/isaaclab.envs.mdp.html">isaaclab.envs.mdp</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/api/lab/isaaclab.envs.ui.html">isaaclab.envs.ui</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/api/lab/isaaclab.sensors.patterns.html">isaaclab.sensors.patterns</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/api/lab/isaaclab.sim.converters.html">isaaclab.sim.converters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/api/lab/isaaclab.sim.schemas.html">isaaclab.sim.schemas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/api/lab/isaaclab.sim.spawners.html">isaaclab.sim.spawners</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/api/lab_rl/isaaclab_rl.html">isaaclab_rl</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../source/api/lab_tasks/isaaclab_tasks.utils.html">isaaclab_tasks.utils</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">References</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../source/refs/additional_resources.html">Additional Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/refs/contributing.html">Contribution Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/refs/troubleshooting.html">Tricks and Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/refs/migration.html">Migration Guide (Isaac Sim)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/refs/issues.html">Known Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/refs/release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/refs/changelog.html">Extensions Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/refs/license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/refs/bibliography.html">Bibliography</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Project Links</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://github.com/isaac-sim/IsaacLab">GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.isaacsim.omniverse.nvidia.com/latest/index.html">NVIDIA Isaac Sim</a></li>
<li class="toctree-l1"><a class="reference external" href="https://nvidia-omniverse.github.io/PhysX/physx/5.4.1/index.html">NVIDIA PhysX</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/isaac-sim/IsaacLab" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/isaac-sim/IsaacLab/issues/new?title=Issue%20on%20page%20%2F_modules/isaaclab/sim/simulation_context.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1></h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for isaaclab.sim.simulation_context</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright (c) 2022-2025, The Isaac Lab Project Developers (https://github.com/isaac-sim/IsaacLab/blob/main/CONTRIBUTORS.md).</span>
<span class="c1"># All rights reserved.</span>
<span class="c1">#</span>
<span class="c1"># SPDX-License-Identifier: BSD-3-Clause</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">builtins</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">enum</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">toml</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">traceback</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">weakref</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections.abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">Iterator</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">contextlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">contextmanager</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">carb</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">flatdict</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">isaacsim.core.utils.stage</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">stage_utils</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">omni.log</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">omni.physx</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">isaacsim.core.api.simulation_context</span><span class="w"> </span><span class="kn">import</span> <span class="n">SimulationContext</span> <span class="k">as</span> <span class="n">_SimulationContext</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">isaacsim.core.utils.carb</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_carb_setting</span><span class="p">,</span> <span class="n">set_carb_setting</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">isaacsim.core.utils.viewports</span><span class="w"> </span><span class="kn">import</span> <span class="n">set_camera_view</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">isaacsim.core.version</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_version</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pxr</span><span class="w"> </span><span class="kn">import</span> <span class="n">Gf</span><span class="p">,</span> <span class="n">PhysxSchema</span><span class="p">,</span> <span class="n">Usd</span><span class="p">,</span> <span class="n">UsdPhysics</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.simulation_cfg</span><span class="w"> </span><span class="kn">import</span> <span class="n">SimulationCfg</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.spawners</span><span class="w"> </span><span class="kn">import</span> <span class="n">DomeLightCfg</span><span class="p">,</span> <span class="n">GroundPlaneCfg</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">bind_physics_material</span>


<div class="viewcode-block" id="SimulationContext"><a class="viewcode-back" href="../../../source/api/lab/isaaclab.sim.html#isaaclab.sim.SimulationContext">[docs]</a><span class="k">class</span><span class="w"> </span><span class="nc">SimulationContext</span><span class="p">(</span><span class="n">_SimulationContext</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A class to control simulation-related events such as physics stepping and rendering.</span>

<span class="sd">    The simulation context helps control various simulation aspects. This includes:</span>

<span class="sd">    * configure the simulator with different settings such as the physics time-step, the number of physics substeps,</span>
<span class="sd">      and the physics solver parameters (for more information, see :class:`isaaclab.sim.SimulationCfg`)</span>
<span class="sd">    * playing, pausing, stepping and stopping the simulation</span>
<span class="sd">    * adding and removing callbacks to different simulation events such as physics stepping, rendering, etc.</span>

<span class="sd">    This class inherits from the :class:`isaacsim.core.api.simulation_context.SimulationContext` class and</span>
<span class="sd">    adds additional functionalities such as setting up the simulation context with a configuration object,</span>
<span class="sd">    exposing other commonly used simulator-related functions, and performing version checks of Isaac Sim</span>
<span class="sd">    to ensure compatibility between releases.</span>

<span class="sd">    The simulation context is a singleton object. This means that there can only be one instance</span>
<span class="sd">    of the simulation context at any given time. This is enforced by the parent class. Therefore, it is</span>
<span class="sd">    not possible to create multiple instances of the simulation context. Instead, the simulation context</span>
<span class="sd">    can be accessed using the ``instance()`` method.</span>

<span class="sd">    .. attention::</span>
<span class="sd">        Since we only support the `PyTorch &lt;https://pytorch.org/&gt;`_ backend for simulation, the</span>
<span class="sd">        simulation context is configured to use the ``torch`` backend by default. This means that</span>
<span class="sd">        all the data structures used in the simulation are ``torch.Tensor`` objects.</span>

<span class="sd">    The simulation context can be used in two different modes of operations:</span>

<span class="sd">    1. **Standalone python script**: In this mode, the user has full control over the simulation and</span>
<span class="sd">       can trigger stepping events synchronously (i.e. as a blocking call). In this case the user</span>
<span class="sd">       has to manually call :meth:`step` step the physics simulation and :meth:`render` to</span>
<span class="sd">       render the scene.</span>
<span class="sd">    2. **Omniverse extension**: In this mode, the user has limited control over the simulation stepping</span>
<span class="sd">       and all the simulation events are triggered asynchronously (i.e. as a non-blocking call). In this</span>
<span class="sd">       case, the user can only trigger the simulation to start, pause, and stop. The simulation takes</span>
<span class="sd">       care of stepping the physics simulation and rendering the scene.</span>

<span class="sd">    Based on above, for most functions in this class there is an equivalent function that is suffixed</span>
<span class="sd">    with ``_async``. The ``_async`` functions are used in the Omniverse extension mode and</span>
<span class="sd">    the non-``_async`` functions are used in the standalone python script mode.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="SimulationContext.RenderMode"><a class="viewcode-back" href="../../../source/api/lab/isaaclab.sim.html#isaaclab.sim.SimulationContext.RenderMode">[docs]</a>    <span class="k">class</span><span class="w"> </span><span class="nc">RenderMode</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">IntEnum</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Different rendering modes for the simulation.</span>

<span class="sd">        Render modes correspond to how the viewport and other UI elements (such as listeners to keyboard or mouse</span>
<span class="sd">        events) are updated. There are three main components that can be updated when the simulation is rendered:</span>

<span class="sd">        1. **UI elements and other extensions**: These are UI elements (such as buttons, sliders, etc.) and other</span>
<span class="sd">           extensions that are running in the background that need to be updated when the simulation is running.</span>
<span class="sd">        2. **Cameras**: These are typically based on Hydra textures and are used to render the scene from different</span>
<span class="sd">           viewpoints. They can be attached to a viewport or be used independently to render the scene.</span>
<span class="sd">        3. **Viewports**: These are windows where you can see the rendered scene.</span>

<span class="sd">        Updating each of the above components has a different overhead. For example, updating the viewports is</span>
<span class="sd">        computationally expensive compared to updating the UI elements. Therefore, it is useful to be able to</span>
<span class="sd">        control what is updated when the simulation is rendered. This is where the render mode comes in. There are</span>
<span class="sd">        four different render modes:</span>

<span class="sd">        * :attr:`NO_GUI_OR_RENDERING`: The simulation is running without a GUI and off-screen rendering flag is disabled,</span>
<span class="sd">          so none of the above are updated.</span>
<span class="sd">        * :attr:`NO_RENDERING`: No rendering, where only 1 is updated at a lower rate.</span>
<span class="sd">        * :attr:`PARTIAL_RENDERING`: Partial rendering, where only 1 and 2 are updated.</span>
<span class="sd">        * :attr:`FULL_RENDERING`: Full rendering, where everything (1, 2, 3) is updated.</span>

<span class="sd">        .. _Viewports: https://docs.omniverse.nvidia.com/extensions/latest/ext_viewport.html</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">NO_GUI_OR_RENDERING</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The simulation is running without a GUI and off-screen rendering is disabled.&quot;&quot;&quot;</span>
        <span class="n">NO_RENDERING</span> <span class="o">=</span> <span class="mi">0</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;No rendering, where only other UI elements are updated at a lower rate.&quot;&quot;&quot;</span>
        <span class="n">PARTIAL_RENDERING</span> <span class="o">=</span> <span class="mi">1</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Partial rendering, where the simulation cameras and UI elements are updated.&quot;&quot;&quot;</span>
        <span class="n">FULL_RENDERING</span> <span class="o">=</span> <span class="mi">2</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Full rendering, where all the simulation viewports, cameras and UI elements are updated.&quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="SimulationContext.__init__"><a class="viewcode-back" href="../../../source/api/lab/isaaclab.sim.html#isaaclab.sim.SimulationContext.__init__">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span><span class="p">:</span> <span class="n">SimulationCfg</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a simulation context to control the simulator.</span>

<span class="sd">        Args:</span>
<span class="sd">            cfg: The configuration of the simulation. Defaults to None,</span>
<span class="sd">                in which case the default configuration is used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># store input</span>
        <span class="k">if</span> <span class="n">cfg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cfg</span> <span class="o">=</span> <span class="n">SimulationCfg</span><span class="p">()</span>
        <span class="c1"># check that the config is valid</span>
        <span class="n">cfg</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">cfg</span>
        <span class="c1"># check that simulation is running</span>
        <span class="k">if</span> <span class="n">stage_utils</span><span class="o">.</span><span class="n">get_current_stage</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;The stage has not been created. Did you run the simulator?&quot;</span><span class="p">)</span>

        <span class="c1"># acquire settings interface</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">carb_settings</span> <span class="o">=</span> <span class="n">carb</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">get_settings</span><span class="p">()</span>

        <span class="c1"># apply carb physics settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_physics_settings</span><span class="p">()</span>

        <span class="c1"># note: we read this once since it is not expected to change during runtime</span>
        <span class="c1"># read flag for whether a local GUI is enabled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_local_gui</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">carb_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/app/window/enabled&quot;</span><span class="p">)</span>
        <span class="c1"># read flag for whether livestreaming GUI is enabled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_livestream_gui</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">carb_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/app/livestream/enabled&quot;</span><span class="p">)</span>
        <span class="c1"># read flag for whether XR GUI is enabled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xr_gui</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">carb_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/app/xr/enabled&quot;</span><span class="p">)</span>

        <span class="c1"># read flag for whether the Isaac Lab viewport capture pipeline will be used,</span>
        <span class="c1"># casting None to False if the flag doesn&#39;t exist</span>
        <span class="c1"># this flag is set from the AppLauncher class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_offscreen_render</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">carb_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/isaaclab/render/offscreen&quot;</span><span class="p">))</span>
        <span class="c1"># read flag for whether the default viewport should be enabled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_render_viewport</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">carb_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/isaaclab/render/active_viewport&quot;</span><span class="p">))</span>
        <span class="c1"># flag for whether any GUI will be rendered (local, livestreamed or viewport)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_has_gui</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_local_gui</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_livestream_gui</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xr_gui</span>

        <span class="c1"># apply render settings from render config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_render_settings_from_cfg</span><span class="p">()</span>

        <span class="c1"># store the default render mode</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_gui</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_offscreen_render</span><span class="p">:</span>
            <span class="c1"># set default render mode</span>
            <span class="c1"># note: this is the terminal state: cannot exit from this render mode</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">render_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RenderMode</span><span class="o">.</span><span class="n">NO_GUI_OR_RENDERING</span>
            <span class="c1"># set viewport context to None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_viewport_context</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_viewport_window</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_gui</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_offscreen_render</span><span class="p">:</span>
            <span class="c1"># set default render mode</span>
            <span class="c1"># note: this is the terminal state: cannot exit from this render mode</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">render_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RenderMode</span><span class="o">.</span><span class="n">PARTIAL_RENDERING</span>
            <span class="c1"># set viewport context to None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_viewport_context</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_viewport_window</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># note: need to import here in case the UI is not available (ex. headless mode)</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">omni.ui</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ui</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">omni.kit.viewport.utility</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_active_viewport</span>

            <span class="c1"># set default render mode</span>
            <span class="c1"># note: this can be changed by calling the `set_render_mode` function</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">render_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RenderMode</span><span class="o">.</span><span class="n">FULL_RENDERING</span>
            <span class="c1"># acquire viewport context</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_viewport_context</span> <span class="o">=</span> <span class="n">get_active_viewport</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_viewport_context</span><span class="o">.</span><span class="n">updates_enabled</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># pyright: ignore [reportOptionalMemberAccess]</span>
            <span class="c1"># acquire viewport window</span>
            <span class="c1"># TODO @mayank: Why not just use get_active_viewport_and_window() directly?</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_viewport_window</span> <span class="o">=</span> <span class="n">ui</span><span class="o">.</span><span class="n">Workspace</span><span class="o">.</span><span class="n">get_window</span><span class="p">(</span><span class="s2">&quot;Viewport&quot;</span><span class="p">)</span>
            <span class="c1"># counter for periodic rendering</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_render_throttle_counter</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1"># rendering frequency in terms of number of render calls</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_render_throttle_period</span> <span class="o">=</span> <span class="mi">5</span>

        <span class="c1"># check the case where we don&#39;t need to render the viewport</span>
        <span class="c1"># since render_viewport can only be False in headless mode, we only need to check for offscreen_render</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_render_viewport</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_offscreen_render</span><span class="p">:</span>
            <span class="c1"># disable the viewport if offscreen_render is enabled</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">omni.kit.viewport.utility</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_active_viewport</span>

            <span class="n">get_active_viewport</span><span class="p">()</span><span class="o">.</span><span class="n">updates_enabled</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># override enable scene querying if rendering is enabled</span>
        <span class="c1"># this is needed for some GUI features</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_gui</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">enable_scene_query_support</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># set up flatcache/fabric interface (default is None)</span>
        <span class="c1"># this is needed to flush the flatcache data into Hydra manually when calling `render()`</span>
        <span class="c1"># ref: https://docs.omniverse.nvidia.com/prod_extensions/prod_extensions/ext_physics.html</span>
        <span class="c1"># note: need to do this here because super().__init__ calls render and this variable is needed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fabric_iface</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># read isaac sim version (this includes build tag, release tag etc.)</span>
        <span class="c1"># note: we do it once here because it reads the VERSION file from disk and is not expected to change.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_isaacsim_version</span> <span class="o">=</span> <span class="n">get_version</span><span class="p">()</span>

        <span class="c1"># create a tensor for gravity</span>
        <span class="c1"># note: this line is needed to create a &quot;tensor&quot; in the device to avoid issues with torch 2.1 onwards.</span>
        <span class="c1">#   the issue is with some heap memory corruption when torch tensor is created inside the asset class.</span>
        <span class="c1">#   you can reproduce the issue by commenting out this line and running the test `test_articulation.py`.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gravity_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">gravity</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

        <span class="c1"># define a global variable to store the exceptions raised in the callback stack</span>
        <span class="n">builtins</span><span class="o">.</span><span class="n">ISAACLAB_CALLBACK_EXCEPTION</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># add callback to deal the simulation app when simulation is stopped.</span>
        <span class="c1"># this is needed because physics views go invalid once we stop the simulation</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">builtins</span><span class="o">.</span><span class="n">ISAAC_LAUNCHED_FROM_TERMINAL</span><span class="p">:</span>
            <span class="n">timeline_event_stream</span> <span class="o">=</span> <span class="n">omni</span><span class="o">.</span><span class="n">timeline</span><span class="o">.</span><span class="n">get_timeline_interface</span><span class="p">()</span><span class="o">.</span><span class="n">get_timeline_event_stream</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_app_control_on_stop_handle</span> <span class="o">=</span> <span class="n">timeline_event_stream</span><span class="o">.</span><span class="n">create_subscription_to_pop_by_type</span><span class="p">(</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">omni</span><span class="o">.</span><span class="n">timeline</span><span class="o">.</span><span class="n">TimelineEventType</span><span class="o">.</span><span class="n">STOP</span><span class="p">),</span>
                <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="n">weakref</span><span class="o">.</span><span class="n">proxy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="n">obj</span><span class="o">.</span><span class="n">_app_control_on_stop_handle_fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">),</span>
                <span class="n">order</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_app_control_on_stop_handle</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_disable_app_control_on_stop_handle</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># flatten out the simulation dictionary</span>
        <span class="n">sim_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">sim_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;physx&quot;</span> <span class="ow">in</span> <span class="n">sim_params</span><span class="p">:</span>
                <span class="n">physx_params</span> <span class="o">=</span> <span class="n">sim_params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;physx&quot;</span><span class="p">)</span>
                <span class="n">sim_params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">physx_params</span><span class="p">)</span>
        <span class="c1"># create a simulation context to control the simulator</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">physx</span><span class="o">.</span><span class="n">enable_stabilization</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">dt</span> <span class="o">&gt;</span> <span class="mf">0.0333</span><span class="p">):</span>
            <span class="n">omni</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Large simulation step size (&gt; 0.0333 seconds) is not recommended without enabling stabilization.&quot;</span>
                <span class="s2">&quot; Consider setting the `enable_stabilization` flag to True in the PhysxCfg, or reducing the&quot;</span>
                <span class="s2">&quot; simulation step size if you run into physics issues.&quot;</span>
            <span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">stage_units_in_meters</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
            <span class="n">physics_dt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span>
            <span class="n">rendering_dt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">dt</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">render_interval</span><span class="p">,</span>
            <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;torch&quot;</span><span class="p">,</span>
            <span class="n">sim_params</span><span class="o">=</span><span class="n">sim_params</span><span class="p">,</span>
            <span class="n">physics_prim_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">physics_prim_path</span><span class="p">,</span>
            <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
        <span class="p">)</span></div>

    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_physics_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets various carb physics settings.&quot;&quot;&quot;</span>
        <span class="c1"># enable hydra scene-graph instancing</span>
        <span class="c1"># note: this allows rendering of instanceable assets on the GUI</span>
        <span class="n">set_carb_setting</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">carb_settings</span><span class="p">,</span> <span class="s2">&quot;/persistent/omnihydra/useSceneGraphInstancing&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="c1"># change dispatcher to use the default dispatcher in PhysX SDK instead of carb tasking</span>
        <span class="c1"># note: dispatcher handles how threads are launched for multi-threaded physics</span>
        <span class="n">set_carb_setting</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">carb_settings</span><span class="p">,</span> <span class="s2">&quot;/physics/physxDispatcher&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="c1"># disable contact processing in omni.physx</span>
        <span class="c1"># note: we disable it by default to avoid the overhead of contact processing when it isn&#39;t needed.</span>
        <span class="c1">#   The physics flag gets enabled when a contact sensor is created.</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">,</span> <span class="s2">&quot;disable_contact_processing&quot;</span><span class="p">):</span>
            <span class="n">omni</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;The `disable_contact_processing` attribute is deprecated and always set to True&quot;</span>
                <span class="s2">&quot; to avoid unnecessary overhead. Contact processing is automatically enabled when&quot;</span>
                <span class="s2">&quot; a contact sensor is created, so manual configuration is no longer required.&quot;</span>
            <span class="p">)</span>
        <span class="c1"># FIXME: From investigation, it seems this flag only affects CPU physics. For GPU physics, contacts</span>
        <span class="c1">#  are always processed. The issue is reported to the PhysX team by @mmittal.</span>
        <span class="n">set_carb_setting</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">carb_settings</span><span class="p">,</span> <span class="s2">&quot;/physics/disableContactProcessing&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="c1"># disable custom geometry for cylinder and cone collision shapes to allow contact reporting for them</span>
        <span class="c1"># reason: cylinders and cones aren&#39;t natively supported by PhysX so we need to use custom geometry flags</span>
        <span class="c1"># reference: https://nvidia-omniverse.github.io/PhysX/physx/5.4.1/docs/Geometry.html?highlight=capsule#geometry</span>
        <span class="n">set_carb_setting</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">carb_settings</span><span class="p">,</span> <span class="s2">&quot;/physics/collisionConeCustomGeometry&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">set_carb_setting</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">carb_settings</span><span class="p">,</span> <span class="s2">&quot;/physics/collisionCylinderCustomGeometry&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="c1"># hide the Simulation Settings window</span>
        <span class="n">set_carb_setting</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">carb_settings</span><span class="p">,</span> <span class="s2">&quot;/physics/autoPopupSimulationOutputWindow&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_render_settings_from_cfg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets rtx settings specified in the RenderCfg.&quot;&quot;&quot;</span>

        <span class="c1"># define mapping of user-friendly RenderCfg names to native carb names</span>
        <span class="n">rendering_setting_name_mapping</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;enable_translucency&quot;</span><span class="p">:</span> <span class="s2">&quot;/rtx/translucency/enabled&quot;</span><span class="p">,</span>
            <span class="s2">&quot;enable_reflections&quot;</span><span class="p">:</span> <span class="s2">&quot;/rtx/reflections/enabled&quot;</span><span class="p">,</span>
            <span class="s2">&quot;enable_global_illumination&quot;</span><span class="p">:</span> <span class="s2">&quot;/rtx/indirectDiffuse/enabled&quot;</span><span class="p">,</span>
            <span class="s2">&quot;enable_dlssg&quot;</span><span class="p">:</span> <span class="s2">&quot;/rtx-transient/dlssg/enabled&quot;</span><span class="p">,</span>
            <span class="s2">&quot;enable_dl_denoiser&quot;</span><span class="p">:</span> <span class="s2">&quot;/rtx-transient/dldenoiser/enabled&quot;</span><span class="p">,</span>
            <span class="s2">&quot;dlss_mode&quot;</span><span class="p">:</span> <span class="s2">&quot;/rtx/post/dlss/execMode&quot;</span><span class="p">,</span>
            <span class="s2">&quot;enable_direct_lighting&quot;</span><span class="p">:</span> <span class="s2">&quot;/rtx/directLighting/enabled&quot;</span><span class="p">,</span>
            <span class="s2">&quot;samples_per_pixel&quot;</span><span class="p">:</span> <span class="s2">&quot;/rtx/directLighting/sampledLighting/samplesPerPixel&quot;</span><span class="p">,</span>
            <span class="s2">&quot;enable_shadows&quot;</span><span class="p">:</span> <span class="s2">&quot;/rtx/shadows/enabled&quot;</span><span class="p">,</span>
            <span class="s2">&quot;enable_ambient_occlusion&quot;</span><span class="p">:</span> <span class="s2">&quot;/rtx/ambientOcclusion/enabled&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">not_carb_settings</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;rendering_mode&quot;</span><span class="p">,</span> <span class="s2">&quot;carb_settings&quot;</span><span class="p">,</span> <span class="s2">&quot;antialiasing_mode&quot;</span><span class="p">]</span>

        <span class="c1"># set preset settings (same behavior as the CLI arg --rendering_mode)</span>
        <span class="n">rendering_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">render</span><span class="o">.</span><span class="n">rendering_mode</span>
        <span class="k">if</span> <span class="n">rendering_mode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># check if preset is supported</span>
            <span class="n">supported_rendering_modes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;performance&quot;</span><span class="p">,</span> <span class="s2">&quot;balanced&quot;</span><span class="p">,</span> <span class="s2">&quot;quality&quot;</span><span class="p">,</span> <span class="s2">&quot;xr&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">rendering_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">supported_rendering_modes</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;RenderCfg rendering mode &#39;</span><span class="si">{</span><span class="n">rendering_mode</span><span class="si">}</span><span class="s2">&#39; not in supported modes </span><span class="si">{</span><span class="n">supported_rendering_modes</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>

            <span class="c1"># parse preset file</span>
            <span class="n">repo_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">carb</span><span class="o">.</span><span class="n">tokens</span><span class="o">.</span><span class="n">get_tokens_interface</span><span class="p">()</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="s2">&quot;$</span><span class="si">{app}</span><span class="s2">&quot;</span><span class="p">),</span> <span class="s2">&quot;..&quot;</span><span class="p">)</span>
            <span class="n">preset_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">repo_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;apps/rendering_modes/</span><span class="si">{</span><span class="n">rendering_mode</span><span class="si">}</span><span class="s2">.kit&quot;</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">preset_filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">preset_dict</span> <span class="o">=</span> <span class="n">toml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="n">preset_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">flatdict</span><span class="o">.</span><span class="n">FlatDict</span><span class="p">(</span><span class="n">preset_dict</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">))</span>

            <span class="c1"># set presets</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">preset_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>  <span class="c1"># convert to carb setting format</span>
                <span class="n">set_carb_setting</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">carb_settings</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="c1"># set user-friendly named settings</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">render</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">not_carb_settings</span><span class="p">:</span>
                <span class="c1"># skip unset settings and non-carb settings</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rendering_setting_name_mapping</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39; in RenderCfg not found. Note: internal &#39;rendering_setting_name_mapping&#39; dictionary might&quot;</span>
                    <span class="s2">&quot; need to be updated.&quot;</span>
                <span class="p">)</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">rendering_setting_name_mapping</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="n">set_carb_setting</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">carb_settings</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="c1"># set general carb settings</span>
        <span class="n">carb_settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">render</span><span class="o">.</span><span class="n">carb_settings</span>
        <span class="k">if</span> <span class="n">carb_settings</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">carb_settings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="s2">&quot;_&quot;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>  <span class="c1"># convert from python variable style string</span>
                <span class="k">elif</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>  <span class="c1"># convert from .kit file style string</span>
                <span class="k">if</span> <span class="n">get_carb_setting</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">carb_settings</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&#39; in RenderCfg.general_parameters does not map to a carb setting.&quot;</span><span class="p">)</span>
                <span class="n">set_carb_setting</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">carb_settings</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="c1"># set denoiser mode</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">render</span><span class="o">.</span><span class="n">antialiasing_mode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">import</span><span class="w"> </span><span class="nn">omni.replicator.core</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rep</span>

                <span class="n">rep</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">set_render_rtx_realtime</span><span class="p">(</span><span class="n">antialiasing</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">render</span><span class="o">.</span><span class="n">antialiasing_mode</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="c1"># WAR: Ensure /rtx/renderMode RaytracedLighting is correctly cased.</span>
        <span class="k">if</span> <span class="n">get_carb_setting</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">carb_settings</span><span class="p">,</span> <span class="s2">&quot;/rtx/rendermode&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;raytracedlighting&quot;</span><span class="p">:</span>
            <span class="n">set_carb_setting</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">carb_settings</span><span class="p">,</span> <span class="s2">&quot;/rtx/rendermode&quot;</span><span class="p">,</span> <span class="s2">&quot;RaytracedLighting&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Operations - New.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="SimulationContext.has_gui"><a class="viewcode-back" href="../../../source/api/lab/isaaclab.sim.html#isaaclab.sim.SimulationContext.has_gui">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">has_gui</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns whether the simulation has a GUI enabled.</span>

<span class="sd">        True if the simulation has a GUI enabled either locally or live-streamed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_gui</span></div>

<div class="viewcode-block" id="SimulationContext.has_rtx_sensors"><a class="viewcode-back" href="../../../source/api/lab/isaaclab.sim.html#isaaclab.sim.SimulationContext.has_rtx_sensors">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">has_rtx_sensors</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns whether the simulation has any RTX-rendering related sensors.</span>

<span class="sd">        This function returns the value of the simulation parameter ``&quot;/isaaclab/render/rtx_sensors&quot;``.</span>
<span class="sd">        The parameter is set to True when instances of RTX-related sensors (cameras or LiDARs) are</span>
<span class="sd">        created using Isaac Lab&#39;s sensor classes.</span>

<span class="sd">        True if the simulation has RTX sensors (such as USD Cameras or LiDARs).</span>

<span class="sd">        For more information, please check `NVIDIA RTX documentation`_.</span>

<span class="sd">        .. _NVIDIA RTX documentation: https://developer.nvidia.com/rendering-technologies</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings</span><span class="o">.</span><span class="n">get_as_bool</span><span class="p">(</span><span class="s2">&quot;/isaaclab/render/rtx_sensors&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SimulationContext.is_fabric_enabled"><a class="viewcode-back" href="../../../source/api/lab/isaaclab.sim.html#isaaclab.sim.SimulationContext.is_fabric_enabled">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_fabric_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns whether the fabric interface is enabled.</span>

<span class="sd">        When fabric interface is enabled, USD read/write operations are disabled. Instead all applications</span>
<span class="sd">        read and write the simulation state directly from the fabric interface. This reduces a lot of overhead</span>
<span class="sd">        that occurs during USD read/write operations.</span>

<span class="sd">        For more information, please check `Fabric documentation`_.</span>

<span class="sd">        .. _Fabric documentation: https://docs.omniverse.nvidia.com/kit/docs/usdrt/latest/docs/usd_fabric_usdrt.html</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fabric_iface</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="SimulationContext.get_version"><a class="viewcode-back" href="../../../source/api/lab/isaaclab.sim.html#isaaclab.sim.SimulationContext.get_version">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_version</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the version of the simulator.</span>

<span class="sd">        This is a wrapper around the ``isaacsim.core.version.get_version()`` function.</span>

<span class="sd">        The returned tuple contains the following information:</span>

<span class="sd">        * Major version (int): This is the year of the release (e.g. 2022).</span>
<span class="sd">        * Minor version (int): This is the half-year of the release (e.g. 1 or 2).</span>
<span class="sd">        * Patch version (int): This is the patch number of the release (e.g. 0).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_isaacsim_version</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_isaacsim_version</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_isaacsim_version</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Operations - New utilities.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="SimulationContext.set_camera_view"><a class="viewcode-back" href="../../../source/api/lab/isaaclab.sim.html#isaaclab.sim.SimulationContext.set_camera_view">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_camera_view</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">eye</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
        <span class="n">target</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
        <span class="n">camera_prim_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;/OmniverseKit_Persp&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the location and target of the viewport camera in the stage.</span>

<span class="sd">        Note:</span>
<span class="sd">            This is a wrapper around the :math:`isaacsim.core.utils.viewports.set_camera_view` function.</span>
<span class="sd">            It is provided here for convenience to reduce the amount of imports needed.</span>

<span class="sd">        Args:</span>
<span class="sd">            eye: The location of the camera eye.</span>
<span class="sd">            target: The location of the camera target.</span>
<span class="sd">            camera_prim_path: The path to the camera primitive in the stage. Defaults to</span>
<span class="sd">                &quot;/OmniverseKit_Persp&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># safe call only if we have a GUI or viewport rendering enabled</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_gui</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_offscreen_render</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_render_viewport</span><span class="p">:</span>
            <span class="n">set_camera_view</span><span class="p">(</span><span class="n">eye</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">camera_prim_path</span><span class="p">)</span></div>

<div class="viewcode-block" id="SimulationContext.set_render_mode"><a class="viewcode-back" href="../../../source/api/lab/isaaclab.sim.html#isaaclab.sim.SimulationContext.set_render_mode">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_render_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="n">RenderMode</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Change the current render mode of the simulation.</span>

<span class="sd">        Please see :class:`RenderMode` for more information on the different render modes.</span>

<span class="sd">        .. note::</span>
<span class="sd">            When no GUI is available (locally or livestreamed), we do not need to choose whether the viewport</span>
<span class="sd">            needs to render or not (since there is no GUI). Thus, in this case, calling the function will not</span>
<span class="sd">            change the render mode.</span>

<span class="sd">        Args:</span>
<span class="sd">            mode (RenderMode): The rendering mode. If different than SimulationContext&#39;s rendering mode,</span>
<span class="sd">            SimulationContext&#39;s mode is changed to the new mode.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the input mode is not supported.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check if mode change is possible -- not possible when no GUI is available</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_gui</span><span class="p">:</span>
            <span class="n">omni</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Cannot change render mode when GUI is disabled. Using the default render mode: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">render_mode</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>
        <span class="c1"># check if there is a mode change</span>
        <span class="c1"># note: this is mostly needed for GUI when we want to switch between full rendering and no rendering.</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_mode</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RenderMode</span><span class="o">.</span><span class="n">FULL_RENDERING</span><span class="p">:</span>
                <span class="c1"># display the viewport and enable updates</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_viewport_context</span><span class="o">.</span><span class="n">updates_enabled</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># pyright: ignore [reportOptionalMemberAccess]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_viewport_window</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># pyright: ignore [reportOptionalMemberAccess]</span>
            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RenderMode</span><span class="o">.</span><span class="n">PARTIAL_RENDERING</span><span class="p">:</span>
                <span class="c1"># hide the viewport and disable updates</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_viewport_context</span><span class="o">.</span><span class="n">updates_enabled</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># pyright: ignore [reportOptionalMemberAccess]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_viewport_window</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># pyright: ignore [reportOptionalMemberAccess]</span>
            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RenderMode</span><span class="o">.</span><span class="n">NO_RENDERING</span><span class="p">:</span>
                <span class="c1"># hide the viewport and disable updates</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_viewport_context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_viewport_context</span><span class="o">.</span><span class="n">updates_enabled</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># pyright: ignore [reportOptionalMemberAccess]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_viewport_window</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># pyright: ignore [reportOptionalMemberAccess]</span>
                <span class="c1"># reset the throttle counter</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_render_throttle_counter</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported render mode: </span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">! Please check `RenderMode` for details.&quot;</span><span class="p">)</span>
            <span class="c1"># update render mode</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">render_mode</span> <span class="o">=</span> <span class="n">mode</span></div>

<div class="viewcode-block" id="SimulationContext.set_setting"><a class="viewcode-back" href="../../../source/api/lab/isaaclab.sim.html#isaaclab.sim.SimulationContext.set_setting">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_setting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set simulation settings using the Carbonite SDK.</span>

<span class="sd">        .. note::</span>
<span class="sd">            If the input setting name does not exist, it will be created. If it does exist, the value will be</span>
<span class="sd">            overwritten. Please make sure to use the correct setting name.</span>

<span class="sd">            To understand the settings interface, please refer to the</span>
<span class="sd">            `Carbonite SDK &lt;https://docs.omniverse.nvidia.com/dev-guide/latest/programmer_ref/settings.html&gt;`_</span>
<span class="sd">            documentation.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: The name of the setting.</span>
<span class="sd">            value: The value of the setting.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_settings</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="SimulationContext.get_setting"><a class="viewcode-back" href="../../../source/api/lab/isaaclab.sim.html#isaaclab.sim.SimulationContext.get_setting">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_setting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Read the simulation setting using the Carbonite SDK.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: The name of the setting.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The value of the setting.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="SimulationContext.forward"><a class="viewcode-back" href="../../../source/api/lab/isaaclab.sim.html#isaaclab.sim.SimulationContext.forward">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Updates articulation kinematics and fabric for rendering.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fabric_iface</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">physics_sim_view</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_playing</span><span class="p">():</span>
                <span class="c1"># Update the articulations&#39; link&#39;s poses before rendering</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">physics_sim_view</span><span class="o">.</span><span class="n">update_articulations_kinematic</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_fabric</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Operations - Override (standalone)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">soft</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_disable_app_control_on_stop_handle</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># check if we need to raise an exception that was raised in a callback</span>
        <span class="k">if</span> <span class="n">builtins</span><span class="o">.</span><span class="n">ISAACLAB_CALLBACK_EXCEPTION</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exception_to_raise</span> <span class="o">=</span> <span class="n">builtins</span><span class="o">.</span><span class="n">ISAACLAB_CALLBACK_EXCEPTION</span>
            <span class="n">builtins</span><span class="o">.</span><span class="n">ISAACLAB_CALLBACK_EXCEPTION</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">raise</span> <span class="n">exception_to_raise</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">soft</span><span class="o">=</span><span class="n">soft</span><span class="p">)</span>
        <span class="c1"># app.update() may be changing the cuda device in reset, so we force it back to our desired device here</span>
        <span class="k">if</span> <span class="s2">&quot;cuda&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">:</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">set_device</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        <span class="c1"># enable kinematic rendering with fabric</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">physics_sim_view</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">physics_sim_view</span><span class="o">.</span><span class="n">_backend</span><span class="o">.</span><span class="n">initialize_kinematic_bodies</span><span class="p">()</span>
        <span class="c1"># perform additional rendering steps to warm up replicator buffers</span>
        <span class="c1"># this is only needed for the first time we set the simulation</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">soft</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_disable_app_control_on_stop_handle</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="SimulationContext.step"><a class="viewcode-back" href="../../../source/api/lab/isaaclab.sim.html#isaaclab.sim.SimulationContext.step">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">render</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Steps the simulation.</span>

<span class="sd">        .. note::</span>
<span class="sd">            This function blocks if the timeline is paused. It only returns when the timeline is playing.</span>

<span class="sd">        Args:</span>
<span class="sd">            render: Whether to render the scene after stepping the physics simulation.</span>
<span class="sd">                    If set to False, the scene is not rendered and only the physics simulation is stepped.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check if we need to raise an exception that was raised in a callback</span>
        <span class="k">if</span> <span class="n">builtins</span><span class="o">.</span><span class="n">ISAACLAB_CALLBACK_EXCEPTION</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exception_to_raise</span> <span class="o">=</span> <span class="n">builtins</span><span class="o">.</span><span class="n">ISAACLAB_CALLBACK_EXCEPTION</span>
            <span class="n">builtins</span><span class="o">.</span><span class="n">ISAACLAB_CALLBACK_EXCEPTION</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">raise</span> <span class="n">exception_to_raise</span>
        <span class="c1"># check if the simulation timeline is paused. in that case keep stepping until it is playing</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_playing</span><span class="p">():</span>
            <span class="c1"># step the simulator (but not the physics) to have UI still active</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_playing</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>
                <span class="c1"># meantime if someone stops, break out of the loop</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_stopped</span><span class="p">():</span>
                    <span class="k">break</span>
            <span class="c1"># need to do one step to refresh the app</span>
            <span class="c1"># reason: physics has to parse the scene again and inform other extensions like hydra-delegate.</span>
            <span class="c1">#   without this the app becomes unresponsive.</span>
            <span class="c1"># FIXME: This steps physics as well, which we is not good in general.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

        <span class="c1"># step the simulation</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">render</span><span class="o">=</span><span class="n">render</span><span class="p">)</span>

        <span class="c1"># app.update() may be changing the cuda device in step, so we force it back to our desired device here</span>
        <span class="k">if</span> <span class="s2">&quot;cuda&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">:</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">set_device</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span></div>

<div class="viewcode-block" id="SimulationContext.render"><a class="viewcode-back" href="../../../source/api/lab/isaaclab.sim.html#isaaclab.sim.SimulationContext.render">[docs]</a>    <span class="k">def</span><span class="w"> </span><span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="n">RenderMode</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Refreshes the rendering components including UI elements and view-ports depending on the render mode.</span>

<span class="sd">        This function is used to refresh the rendering components of the simulation. This includes updating the</span>
<span class="sd">        view-ports, UI elements, and other extensions (besides physics simulation) that are running in the</span>
<span class="sd">        background. The rendering components are refreshed based on the render mode.</span>

<span class="sd">        Please see :class:`RenderMode` for more information on the different render modes.</span>

<span class="sd">        Args:</span>
<span class="sd">            mode: The rendering mode. Defaults to None, in which case the current rendering mode is used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check if we need to raise an exception that was raised in a callback</span>
        <span class="k">if</span> <span class="n">builtins</span><span class="o">.</span><span class="n">ISAACLAB_CALLBACK_EXCEPTION</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exception_to_raise</span> <span class="o">=</span> <span class="n">builtins</span><span class="o">.</span><span class="n">ISAACLAB_CALLBACK_EXCEPTION</span>
            <span class="n">builtins</span><span class="o">.</span><span class="n">ISAACLAB_CALLBACK_EXCEPTION</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">raise</span> <span class="n">exception_to_raise</span>
        <span class="c1"># check if we need to change the render mode</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_render_mode</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
        <span class="c1"># render based on the render mode</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_mode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RenderMode</span><span class="o">.</span><span class="n">NO_GUI_OR_RENDERING</span><span class="p">:</span>
            <span class="c1"># we never want to render anything here (this is for complete headless mode)</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_mode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">RenderMode</span><span class="o">.</span><span class="n">NO_RENDERING</span><span class="p">:</span>
            <span class="c1"># throttle the rendering frequency to keep the UI responsive</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_render_throttle_counter</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_render_throttle_counter</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_render_throttle_period</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_render_throttle_counter</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="c1"># here we don&#39;t render viewport so don&#39;t need to flush fabric data</span>
                <span class="c1"># note: we don&#39;t call super().render() anymore because they do flush the fabric data</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_setting</span><span class="p">(</span><span class="s2">&quot;/app/player/playSimulations&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_app</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_setting</span><span class="p">(</span><span class="s2">&quot;/app/player/playSimulations&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># manually flush the fabric data to update Hydra textures</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">()</span>
            <span class="c1"># render the simulation</span>
            <span class="c1"># note: we don&#39;t call super().render() anymore because they do above operation inside</span>
            <span class="c1">#  and we don&#39;t want to do it twice. We may remove it once we drop support for Isaac Sim 2022.2.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_setting</span><span class="p">(</span><span class="s2">&quot;/app/player/playSimulations&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_app</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_setting</span><span class="p">(</span><span class="s2">&quot;/app/player/playSimulations&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="c1"># app.update() may be changing the cuda device, so we force it back to our desired device here</span>
        <span class="k">if</span> <span class="s2">&quot;cuda&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">:</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">set_device</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Operations - Override (extension)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">reset_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">soft</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="c1"># need to load all &quot;physics&quot; information from the USD file</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">soft</span><span class="p">:</span>
            <span class="n">omni</span><span class="o">.</span><span class="n">physx</span><span class="o">.</span><span class="n">acquire_physx_interface</span><span class="p">()</span><span class="o">.</span><span class="n">force_load_physics_from_usd</span><span class="p">()</span>
        <span class="c1"># play the simulation</span>
        <span class="k">await</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">reset_async</span><span class="p">(</span><span class="n">soft</span><span class="o">=</span><span class="n">soft</span><span class="p">)</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialization/Destruction - Override.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_init_stage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Usd</span><span class="o">.</span><span class="n">Stage</span><span class="p">:</span>
        <span class="n">_</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_init_stage</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># a stage update here is needed for the case when physics_dt != rendering_dt, otherwise the app crashes</span>
        <span class="c1"># when in headless mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_setting</span><span class="p">(</span><span class="s2">&quot;/app/player/playSimulations&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_app</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_setting</span><span class="p">(</span><span class="s2">&quot;/app/player/playSimulations&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="c1"># set additional physx parameters and bind material</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_additional_physx_params</span><span class="p">()</span>
        <span class="c1"># load flatcache/fabric interface</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_fabric_interface</span><span class="p">()</span>
        <span class="c1"># return the stage</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_initialize_stage_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Usd</span><span class="o">.</span><span class="n">Stage</span><span class="p">:</span>
        <span class="k">await</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_initialize_stage_async</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># set additional physx parameters and bind material</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_additional_physx_params</span><span class="p">()</span>
        <span class="c1"># load flatcache/fabric interface</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_fabric_interface</span><span class="p">()</span>
        <span class="c1"># return the stage</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">clear_instance</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="c1"># clear the callback</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span><span class="o">.</span><span class="n">_app_control_on_stop_handle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span><span class="o">.</span><span class="n">_app_control_on_stop_handle</span><span class="o">.</span><span class="n">unsubscribe</span><span class="p">()</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span><span class="o">.</span><span class="n">_app_control_on_stop_handle</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># call parent to clear the instance</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">clear_instance</span><span class="p">()</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper Functions</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_set_additional_physx_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets additional PhysX parameters that are not directly supported by the parent class.&quot;&quot;&quot;</span>
        <span class="c1"># obtain the physics scene api</span>
        <span class="n">physics_scene</span><span class="p">:</span> <span class="n">UsdPhysics</span><span class="o">.</span><span class="n">Scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_physics_context</span><span class="o">.</span><span class="n">_physics_scene</span>
        <span class="n">physx_scene_api</span><span class="p">:</span> <span class="n">PhysxSchema</span><span class="o">.</span><span class="n">PhysxSceneAPI</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_physics_context</span><span class="o">.</span><span class="n">_physx_scene_api</span>
        <span class="c1"># assert that scene api is not None</span>
        <span class="k">if</span> <span class="n">physx_scene_api</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Physics scene API is None! Please create the scene first.&quot;</span><span class="p">)</span>
        <span class="c1"># set parameters not directly supported by the constructor</span>
        <span class="c1"># -- Continuous Collision Detection (CCD)</span>
        <span class="c1"># ref: https://nvidia-omniverse.github.io/PhysX/physx/5.4.1/docs/AdvancedCollisionDetection.html?highlight=ccd#continuous-collision-detection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_physics_context</span><span class="o">.</span><span class="n">enable_ccd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">physx</span><span class="o">.</span><span class="n">enable_ccd</span><span class="p">)</span>
        <span class="c1"># -- GPU collision stack size</span>
        <span class="n">physx_scene_api</span><span class="o">.</span><span class="n">CreateGpuCollisionStackSizeAttr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">physx</span><span class="o">.</span><span class="n">gpu_collision_stack_size</span><span class="p">)</span>
        <span class="c1"># -- Improved determinism by PhysX</span>
        <span class="n">physx_scene_api</span><span class="o">.</span><span class="n">CreateEnableEnhancedDeterminismAttr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">physx</span><span class="o">.</span><span class="n">enable_enhanced_determinism</span><span class="p">)</span>

        <span class="c1"># -- Gravity</span>
        <span class="c1"># note: Isaac sim only takes the &quot;up-axis&quot; as the gravity direction. But physics allows any direction so we</span>
        <span class="c1">#  need to convert the gravity vector to a direction and magnitude pair explicitly.</span>
        <span class="n">gravity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">gravity</span><span class="p">)</span>
        <span class="n">gravity_magnitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">gravity</span><span class="p">)</span>

        <span class="c1"># Avoid division by zero</span>
        <span class="k">if</span> <span class="n">gravity_magnitude</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">gravity_direction</span> <span class="o">=</span> <span class="n">gravity</span> <span class="o">/</span> <span class="n">gravity_magnitude</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">gravity_direction</span> <span class="o">=</span> <span class="n">gravity</span>

        <span class="n">physics_scene</span><span class="o">.</span><span class="n">CreateGravityDirectionAttr</span><span class="p">(</span><span class="n">Gf</span><span class="o">.</span><span class="n">Vec3f</span><span class="p">(</span><span class="o">*</span><span class="n">gravity_direction</span><span class="p">))</span>
        <span class="n">physics_scene</span><span class="o">.</span><span class="n">CreateGravityMagnitudeAttr</span><span class="p">(</span><span class="n">gravity_magnitude</span><span class="p">)</span>

        <span class="c1"># position iteration count</span>
        <span class="n">physx_scene_api</span><span class="o">.</span><span class="n">CreateMinPositionIterationCountAttr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">physx</span><span class="o">.</span><span class="n">min_position_iteration_count</span><span class="p">)</span>
        <span class="n">physx_scene_api</span><span class="o">.</span><span class="n">CreateMaxPositionIterationCountAttr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">physx</span><span class="o">.</span><span class="n">max_position_iteration_count</span><span class="p">)</span>
        <span class="c1"># velocity iteration count</span>
        <span class="n">physx_scene_api</span><span class="o">.</span><span class="n">CreateMinVelocityIterationCountAttr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">physx</span><span class="o">.</span><span class="n">min_velocity_iteration_count</span><span class="p">)</span>
        <span class="n">physx_scene_api</span><span class="o">.</span><span class="n">CreateMaxVelocityIterationCountAttr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">physx</span><span class="o">.</span><span class="n">max_velocity_iteration_count</span><span class="p">)</span>

        <span class="c1"># create the default physics material</span>
        <span class="c1"># this material is used when no material is specified for a primitive</span>
        <span class="c1"># check: https://docs.omniverse.nvidia.com/extensions/latest/ext_physics/simulation-control/physics-settings.html#physics-materials</span>
        <span class="n">material_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">physics_prim_path</span><span class="si">}</span><span class="s2">/defaultMaterial&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">physics_material</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">material_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">physics_material</span><span class="p">)</span>
        <span class="c1"># bind the physics material to the scene</span>
        <span class="n">bind_physics_material</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">physics_prim_path</span><span class="p">,</span> <span class="n">material_path</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_fabric_interface</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Loads the fabric interface if enabled.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">use_fabric</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">omni.physxfabric</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_physx_fabric_interface</span>

            <span class="c1"># acquire fabric interface</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fabric_iface</span> <span class="o">=</span> <span class="n">get_physx_fabric_interface</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fabric_iface</span><span class="p">,</span> <span class="s2">&quot;force_update&quot;</span><span class="p">):</span>
                <span class="c1"># The update method in the fabric interface only performs an update if a physics step has occurred.</span>
                <span class="c1"># However, for rendering, we need to force an update since any element of the scene might have been</span>
                <span class="c1"># modified in a reset (which occurs after the physics step) and we want the renderer to be aware of</span>
                <span class="c1"># these changes.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_update_fabric</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fabric_iface</span><span class="o">.</span><span class="n">force_update</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Needed for backward compatibility with older Isaac Sim versions</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_update_fabric</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fabric_iface</span><span class="o">.</span><span class="n">update</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Callbacks.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_app_control_on_stop_handle_fn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">carb</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">IEvent</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Callback to deal with the app when the simulation is stopped.</span>

<span class="sd">        Once the simulation is stopped, the physics handles go invalid. After that, it is not possible to</span>
<span class="sd">        resume the simulation from the last state. This leaves the app in an inconsistent state, where</span>
<span class="sd">        two possible actions can be taken:</span>

<span class="sd">        1. **Keep the app rendering**: In this case, the simulation is kept running and the app is not shutdown.</span>
<span class="sd">           However, the physics is not updated and the script cannot be resumed from the last state. The</span>
<span class="sd">           user has to manually close the app to stop the simulation.</span>
<span class="sd">        2. **Shutdown the app**: This is the default behavior. In this case, the app is shutdown and</span>
<span class="sd">           the simulation is stopped.</span>

<span class="sd">        Note:</span>
<span class="sd">            This callback is used only when running the simulation in a standalone python script. In an extension,</span>
<span class="sd">            it is expected that the user handles the extension shutdown.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_disable_app_control_on_stop_handle</span><span class="p">:</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="n">omni</span><span class="o">.</span><span class="n">timeline</span><span class="o">.</span><span class="n">get_timeline_interface</span><span class="p">()</span><span class="o">.</span><span class="n">is_playing</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>
        <span class="k">return</span></div>


<span class="nd">@contextmanager</span>
<span class="k">def</span><span class="w"> </span><span class="nf">build_simulation_context</span><span class="p">(</span>
    <span class="n">create_new_stage</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">gravity_enabled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;cuda:0&quot;</span><span class="p">,</span>
    <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
    <span class="n">sim_cfg</span><span class="p">:</span> <span class="n">SimulationCfg</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">add_ground_plane</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">add_lighting</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">auto_add_lighting</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">SimulationContext</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Context manager to build a simulation context with the provided settings.</span>

<span class="sd">    This function facilitates the creation of a simulation context and provides flexibility in configuring various</span>
<span class="sd">    aspects of the simulation, such as time step, gravity, device, and scene elements like ground plane and</span>
<span class="sd">    lighting.</span>

<span class="sd">    If :attr:`sim_cfg` is None, then an instance of :class:`SimulationCfg` is created with default settings, with parameters</span>
<span class="sd">    overwritten based on arguments to the function.</span>

<span class="sd">    An example usage of the context manager function:</span>

<span class="sd">    ..  code-block:: python</span>

<span class="sd">        with build_simulation_context() as sim:</span>
<span class="sd">             # Design the scene</span>

<span class="sd">             # Play the simulation</span>
<span class="sd">             sim.reset()</span>
<span class="sd">             while sim.is_playing():</span>
<span class="sd">                 sim.step()</span>

<span class="sd">    Args:</span>
<span class="sd">        create_new_stage: Whether to create a new stage. Defaults to True.</span>
<span class="sd">        gravity_enabled: Whether to enable gravity in the simulation. Defaults to True.</span>
<span class="sd">        device: Device to run the simulation on. Defaults to &quot;cuda:0&quot;.</span>
<span class="sd">        dt: Time step for the simulation: Defaults to 0.01.</span>
<span class="sd">        sim_cfg: :class:`isaaclab.sim.SimulationCfg` to use for the simulation. Defaults to None.</span>
<span class="sd">        add_ground_plane: Whether to add a ground plane to the simulation. Defaults to False.</span>
<span class="sd">        add_lighting: Whether to add a dome light to the simulation. Defaults to False.</span>
<span class="sd">        auto_add_lighting: Whether to automatically add a dome light to the simulation if the simulation has a GUI.</span>
<span class="sd">            Defaults to False. This is useful for debugging tests in the GUI.</span>

<span class="sd">    Yields:</span>
<span class="sd">        The simulation context to use for the simulation.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">create_new_stage</span><span class="p">:</span>
            <span class="n">stage_utils</span><span class="o">.</span><span class="n">create_new_stage</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">sim_cfg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Construct one and overwrite the dt, gravity, and device</span>
            <span class="n">sim_cfg</span> <span class="o">=</span> <span class="n">SimulationCfg</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">)</span>

            <span class="c1"># Set up gravity</span>
            <span class="k">if</span> <span class="n">gravity_enabled</span><span class="p">:</span>
                <span class="n">sim_cfg</span><span class="o">.</span><span class="n">gravity</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.81</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sim_cfg</span><span class="o">.</span><span class="n">gravity</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>

            <span class="c1"># Set device</span>
            <span class="n">sim_cfg</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>

        <span class="c1"># Construct simulation context</span>
        <span class="n">sim</span> <span class="o">=</span> <span class="n">SimulationContext</span><span class="p">(</span><span class="n">sim_cfg</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">add_ground_plane</span><span class="p">:</span>
            <span class="c1"># Ground-plane</span>
            <span class="n">cfg</span> <span class="o">=</span> <span class="n">GroundPlaneCfg</span><span class="p">()</span>
            <span class="n">cfg</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="s2">&quot;/World/defaultGroundPlane&quot;</span><span class="p">,</span> <span class="n">cfg</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">add_lighting</span> <span class="ow">or</span> <span class="p">(</span><span class="n">auto_add_lighting</span> <span class="ow">and</span> <span class="n">sim</span><span class="o">.</span><span class="n">has_gui</span><span class="p">()):</span>
            <span class="c1"># Lighting</span>
            <span class="n">cfg</span> <span class="o">=</span> <span class="n">DomeLightCfg</span><span class="p">(</span>
                <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
                <span class="n">enable_color_temperature</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">color_temperature</span><span class="o">=</span><span class="mi">5500</span><span class="p">,</span>
                <span class="n">intensity</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># Dome light named specifically to avoid conflicts</span>
            <span class="n">cfg</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">prim_path</span><span class="o">=</span><span class="s2">&quot;/World/defaultDomeLight&quot;</span><span class="p">,</span> <span class="n">cfg</span><span class="o">=</span><span class="n">cfg</span><span class="p">,</span> <span class="n">translation</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">))</span>

        <span class="k">yield</span> <span class="n">sim</span>

    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">omni</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
        <span class="k">raise</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sim</span><span class="o">.</span><span class="n">has_gui</span><span class="p">():</span>
            <span class="c1"># Stop simulation only if we aren&#39;t rendering otherwise the app will hang indefinitely</span>
            <span class="n">sim</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

        <span class="c1"># Clear the stage</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">clear_all_callbacks</span><span class="p">()</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">clear_instance</span><span class="p">()</span>
        <span class="c1"># check if we need to raise an exception that was raised in a callback</span>
        <span class="k">if</span> <span class="n">builtins</span><span class="o">.</span><span class="n">ISAACLAB_CALLBACK_EXCEPTION</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exception_to_raise</span> <span class="o">=</span> <span class="n">builtins</span><span class="o">.</span><span class="n">ISAACLAB_CALLBACK_EXCEPTION</span>
            <span class="n">builtins</span><span class="o">.</span><span class="n">ISAACLAB_CALLBACK_EXCEPTION</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">raise</span> <span class="n">exception_to_raise</span>
</pre></div>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Isaac Lab Project Developers.
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022-2025, The Isaac Lab Project Developers..
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    <p class="last-updated">
  Last updated on Oct 28, 2025.
  <br/>
</p>
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>